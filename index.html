<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pizzaria Delícia</title>
   <link rel="stylesheet" href="estilo.css">
</head>
<body>
  <header>
    <img src="https://img.icons8.com/ios-filled/50/ffffff/pizza.png" alt="Logo Pizzaria" />
    <h1>Pizzaria Delícia</h1>

    <img id="logo-pizzaria" src="" alt="Logo Pizzaria" />
    <h1 id="nome-pizzaria"></h1>
  </header>
  
  <button class="toggle-menu" id="toggleMenu">Ir para BEBIDAS</button>
  
  <main>
    <section class="pizza-menu" id="menu"></section>
  </main>
  
  <div class="cart-container">
    <section class="cart-section" id="cart">
      <h2>Resumo do Pedido</h2>
      <div id="empty-cart" class="empty-cart">Seu carrinho está vazio</div>
      <ul id="cart-list" class="cart-list"></ul>
      <div id="total" class="total"></div>
      <button id="btnFinalizar" class="btn-finalizar" disabled>Finalizar Pedido</button>
    </section>
  </div>

  <!-- Modal de Finalização -->
  <div class="modal-overlay" id="modalFinalizar">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Finalizar Pedido</h2>
        <button class="close-modal" id="closeModal">&times;</button>
      </div>
      <form id="formFinalizar">
        <div class="address-fields">
          <div class="form-group">
            <label for="endereco">Endereço</label>
            <input type="text" id="endereco" required placeholder="Rua, Avenida, etc">
          </div>
          <div class="form-group">
            <label for="numero">Número</label>
            <input type="text" id="numero" required placeholder="Nº">
          </div>
        </div>
        <div class="form-group">
          <label for="complemento">Complemento (opcional)</label>
          <input type="text" id="complemento" placeholder="Ap, Torre, Condomínio, etc">
        </div>
        <div class="form-group">
          <label for="pagamento">Forma de Pagamento</label>
          <select id="pagamento" required>
            <option value="">Selecione...</option>
            <option value="Dinheiro">Dinheiro</option>
            <option value="Cartão de Crédito">Cartão de Crédito</option>
            <option value="Cartão de Débito">Cartão de Débito</option>
            <option value="PIX">PIX</option>
          </select>
        </div>
        <div class="form-group" id="trocoField" style="display: none;">
          <label for="troco">Troco para (opcional)</label>
          <input type="text" id="troco" placeholder="R$ 0,00">
        </div>
        <button type="submit" class="btn-enviar">Enviar Pedido via WhatsApp</button>
      </form>
    </div>
  </div>

  <script>
 
 // Configurações
 fetch('dados/lalenha/configuracoes.json')
  .then(response => response.json())
  .then(data => {
    document.getElementById('logo-pizzaria').src = data.logo;
    document.getElementById('nome-pizzaria').textContent = data.nome;
  })
  .catch(error => {
    console.error('Erro ao carregar os dados da pizzaria:', error);
  });

  let pizzas;
  let bebidas;

  fetch('dados/lalenha/pizzas.json')
  .then(res => res.json())
  .then(data => {
    pizzas = data; // aqui pizzas é o resultado real, um array de objetos
    renderMenu();
   })
  .catch(err => console.error(err));

  fetch('dados/lalenha/bebidas.json')
  .then(res => res.json())
  .then(data => {
    bebidas = data; 
   })
  .catch(err => console.error(err)); 

    const menuEl = document.getElementById('menu');
    const cartList = document.getElementById('cart-list');
    const totalEl = document.getElementById('total');
    const emptyCartEl = document.getElementById('empty-cart');
    const toggleMenuBtn = document.getElementById('toggleMenu');
    const btnFinalizar = document.getElementById('btnFinalizar');
    const modalFinalizar = document.getElementById('modalFinalizar');
    const closeModal = document.getElementById('closeModal');
    const formFinalizar = document.getElementById('formFinalizar');
    const pagamentoSelect = document.getElementById('pagamento');
    const trocoField = document.getElementById('trocoField');
    
    let carrinho = [];
    let meiaPizzaPendente = null;
    let exibindoBebidas = false;

    // Função para alternar entre pizzas e bebidas
    function toggleMenu() {
      exibindoBebidas = !exibindoBebidas;
      toggleMenuBtn.textContent = exibindoBebidas ? "Ir para PIZZAS" : "Ir para BEBIDAS";
      renderMenu();
    }

    function renderMenu() {
      menuEl.innerHTML = '';
      const itens = exibindoBebidas ? bebidas : pizzas;
      
      itens.forEach(item => {
        const card = document.createElement('article');
        card.classList.add('pizza-card');
        card.dataset.id = item.id;

        card.innerHTML = `
          <img src="${item.image}" alt="${item.name}" />
          <div class="pizza-info">
            <h3 class="pizza-name">${item.name}</h3>
            ${!exibindoBebidas ? `<p class="pizza-ingredients">${item.ingredients}</p>` : ''}
            <div class="pizza-footer">
              <div class="pizza-price">R$ ${item.price.toFixed(2)}</div>
            </div>
          </div>
        `;

        if (!exibindoBebidas) {
          const meiaBtn = document.createElement('button');
          meiaBtn.textContent = 'Meia';
          meiaBtn.className = 'btn-meia';
          meiaBtn.onclick = (ev) => {
            ev.stopPropagation();
            addMeiaPizza(item.id);
          };
          card.querySelector('.pizza-footer').appendChild(meiaBtn);
        }

        card.addEventListener('click', () => {
          if (exibindoBebidas) {
            addBebidaToCart(item.id);
          } else {
            addPizzaToCart(item.id);
          }
        });
        
        menuEl.appendChild(card);
      });
    }

    function addPizzaToCart(pizzaId) {
      if (meiaPizzaPendente !== null) {
        const nova = [meiaPizzaPendente, pizzaId].sort((a,b) => a-b);
        const existente = carrinho.find(i => i.type === 'meia' && i.pizzas.length === 2 && i.pizzas.join() === nova.join());
        
        if (existente) {
          existente.quantity++;
        } else {
          carrinho.push({ 
            type: 'meia', 
            pizzas: nova, 
            quantity: 1,
            timestamp: Date.now()
          });
        }
        
        const idxPendente = carrinho.findIndex(item => item.type === 'meia' && item.pizzas.length === 1 && item.pizzas[0] === meiaPizzaPendente);
        if (idxPendente >= 0) {
          carrinho.splice(idxPendente, 1);
        }
        
        meiaPizzaPendente = null;
      } else {
        const idx = carrinho.findIndex(item => item.type === 'inteira' && item.pizzaId === pizzaId);
        if (idx >= 0) {
          carrinho[idx].quantity++;
        } else {
          carrinho.push({ 
            type: 'inteira', 
            pizzaId, 
            quantity: 1,
            timestamp: Date.now()
          });
        }
      }
      renderCart();
    }

    function addBebidaToCart(bebidaId) {
      const idx = carrinho.findIndex(item => item.type === 'bebida' && item.bebidaId === bebidaId);
      if (idx >= 0) {
        carrinho[idx].quantity++;
      } else {
        carrinho.push({ 
          type: 'bebida', 
          bebidaId, 
          quantity: 1,
          timestamp: Date.now()
        });
      }
      renderCart();
    }

    function addMeiaPizza(pizzaId) {
      if (meiaPizzaPendente !== null && meiaPizzaPendente !== pizzaId) {
        const nova = [meiaPizzaPendente, pizzaId].sort((a,b) => a-b);
        const existente = carrinho.find(i => i.type === 'meia' && i.pizzas.length === 2 && i.pizzas.join() === nova.join());
        
        if (existente) {
          existente.quantity++;
        } else {
          carrinho.push({ 
            type: 'meia', 
            pizzas: nova, 
            quantity: 1,
            timestamp: Date.now()
          });
        }
        
        const idxPendente = carrinho.findIndex(item => item.type === 'meia' && item.pizzas.length === 1 && item.pizzas[0] === meiaPizzaPendente);
        if (idxPendente >= 0) {
          carrinho.splice(idxPendente, 1);
        }
        
        meiaPizzaPendente = null;
      } else {
        meiaPizzaPendente = pizzaId;
        
        const existente = carrinho.find(i => i.type === 'meia' && i.pizzas.length === 1 && i.pizzas[0] === pizzaId);
        if (existente) {
          existente.quantity++;
        } else {
          carrinho.push({ 
            type: 'meia', 
            pizzas: [pizzaId], 
            quantity: 1,
            timestamp: Date.now()
          });
        }
      }
      renderCart();
    }

    function renderCart() {
      if (carrinho.length === 0) {
        emptyCartEl.style.display = 'block';
        cartList.style.display = 'none';
        totalEl.style.display = 'none';
        btnFinalizar.disabled = true;
        return;
      }
      
      emptyCartEl.style.display = 'none';
      cartList.style.display = 'block';
      totalEl.style.display = 'block';
      btnFinalizar.disabled = false;
      cartList.innerHTML = '';

      // Ordena os itens por timestamp (mais recente primeiro)
      const carrinhoOrdenado = [...carrinho].sort((a, b) => b.timestamp - a.timestamp);

      carrinhoOrdenado.forEach((item, index) => {
        const originalIndex = carrinho.findIndex(i => i.timestamp === item.timestamp);
        const li = document.createElement('li');
        let name, price;

        if (item.type === 'inteira') {
          const pizza = pizzas.find(p => p.id === item.pizzaId);
          name = pizza.name;
          price = pizza.price;
        } else if (item.type === 'meia') {
          if (item.pizzas.length === 1) {
            const pizza = pizzas.find(p => p.id === item.pizzas[0]);
            name = `Meia pizza de ${pizza.name} (escolha outra metade)`;
            price = pizza.price / 2;
          } else if (item.pizzas.length === 2) {
            const pizza1 = pizzas.find(p => p.id === item.pizzas[0]);
            const pizza2 = pizzas.find(p => p.id === item.pizzas[1]);
            name = `Meia ${pizza1.name} + meia ${pizza2.name}`;
            price = Math.max(pizza1.price, pizza2.price);
          }
        } else if (item.type === 'bebida') {
          const bebida = bebidas.find(b => b.id === item.bebidaId);
          name = bebida.name;
          price = bebida.price;
        }

        const itemTotalPrice = price * item.quantity;

        li.innerHTML = `
          <div class="item-name">${name}</div>
          <div class="quantity-controls">
            <button onclick="decrement(${originalIndex})">−</button>
            <span>${item.quantity}</span>
            <button onclick="increment(${originalIndex})">+</button>
          </div>
          <div class="item-price">R$ ${itemTotalPrice.toFixed(2)}</div>
        `;

        cartList.appendChild(li);
      });

      const total = carrinho.reduce((acc, item) => {
        let price = 0;
        if (item.type === 'inteira') {
          const pizza = pizzas.find(p => p.id === item.pizzaId);
          price = pizza.price;
        } else if (item.type === 'meia') {
          if (item.pizzas.length === 1) {
            const pizza = pizzas.find(p => p.id === item.pizzas[0]);
            price = pizza.price / 2;
          } else if (item.pizzas.length === 2) {
            const pizza1 = pizzas.find(p => p.id === item.pizzas[0]);
            const pizza2 = pizzas.find(p => p.id === item.pizzas[1]);
            price = Math.max(pizza1.price, pizza2.price);
          }
        } else if (item.type === 'bebida') {
          const bebida = bebidas.find(b => b.id === item.bebidaId);
          price = bebida.price;
        }
        return acc + price * item.quantity;
      }, 0);

      totalEl.textContent = `Total: R$ ${total.toFixed(2)}`;
    }

    function increment(index) {
      carrinho[index].quantity++;
      renderCart();
    }

    function decrement(index) {
      if (carrinho[index].quantity > 1) {
        carrinho[index].quantity--;
      } else {
        if (meiaPizzaPendente !== null && carrinho[index].type === 'meia' && carrinho[index].pizzas[0] === meiaPizzaPendente) {
          meiaPizzaPendente = null;
        }
        carrinho.splice(index, 1);
      }
      renderCart();
    }

    function abrirModalFinalizar() {
      modalFinalizar.classList.add('active');
    }

    function fecharModalFinalizar() {
      modalFinalizar.classList.remove('active');
    }

    function formatarPedidoParaWhatsApp() {
      let mensagem = "🍕 *Pedido Pizzaria Delícia* 🍕\n\n";
      mensagem += "*Itens do Pedido:*\n";
      
      carrinho.forEach(item => {
        let name, price;
        
        if (item.type === 'inteira') {
          const pizza = pizzas.find(p => p.id === item.pizzaId);
          name = pizza.name;
          price = pizza.price;
        } else if (item.type === 'meia') {
          if (item.pizzas.length === 1) {
            const pizza = pizzas.find(p => p.id === item.pizzas[0]);
            name = `Meia pizza de ${pizza.name} (escolha outra metade)`;
            price = pizza.price / 2;
          } else if (item.pizzas.length === 2) {
            const pizza1 = pizzas.find(p => p.id === item.pizzas[0]);
            const pizza2 = pizzas.find(p => p.id === item.pizzas[1]);
            name = `Meia ${pizza1.name} + meia ${pizza2.name}`;
            price = Math.max(pizza1.price, pizza2.price);
          }
        } else if (item.type === 'bebida') {
          const bebida = bebidas.find(b => b.id === item.bebidaId);
          name = bebida.name;
          price = bebida.price;
        }
        
        mensagem += `- ${name} x${item.quantity} - R$ ${(price * item.quantity).toFixed(2)}\n`;
      });
      
      const total = carrinho.reduce((acc, item) => {
        let price = 0;
        if (item.type === 'inteira') {
          const pizza = pizzas.find(p => p.id === item.pizzaId);
          price = pizza.price;
        } else if (item.type === 'meia') {
          if (item.pizzas.length === 1) {
            const pizza = pizzas.find(p => p.id === item.pizzas[0]);
            price = pizza.price / 2;
          } else if (item.pizzas.length === 2) {
            const pizza1 = pizzas.find(p => p.id === item.pizzas[0]);
            const pizza2 = pizzas.find(p => p.id === item.pizzas[1]);
            price = Math.max(pizza1.price, pizza2.price);
          }
        } else if (item.type === 'bebida') {
          const bebida = bebidas.find(b => b.id === item.bebidaId);
          price = bebida.price;
        }
        return acc + price * item.quantity;
      }, 0);
      
      mensagem += `\n*Total: R$ ${total.toFixed(2)}*\n\n`;
      mensagem += `*Endereço de Entrega:*\n${document.getElementById('endereco').value}, ${document.getElementById('numero').value}`;
      
      const complemento = document.getElementById('complemento').value;
      if (complemento) {
        mensagem += ` - ${complemento}`;
      }
      
      mensagem += `\n\n*Forma de Pagamento:* ${document.getElementById('pagamento').value}`;
      
      const troco = document.getElementById('troco').value;
      if (troco && document.getElementById('pagamento').value === 'Dinheiro') {
        mensagem += `\n*Troco para:* ${troco}`;
      }
      
      return encodeURIComponent(mensagem);
    }

    // Event listeners
    toggleMenuBtn.addEventListener('click', toggleMenu);
    btnFinalizar.addEventListener('click', abrirModalFinalizar);
    closeModal.addEventListener('click', fecharModalFinalizar);
    
    // Fechar modal ao clicar fora
    modalFinalizar.addEventListener('click', (e) => {
      if (e.target === modalFinalizar) {
        fecharModalFinalizar();
      }
    });
    
    // Mostrar campo de troco quando selecionar Dinheiro
    pagamentoSelect.addEventListener('change', () => {
      if (pagamentoSelect.value === 'Dinheiro') {
        trocoField.style.display = 'block';
      } else {
        trocoField.style.display = 'none';
      }
    });
    
    // Enviar pedido via WhatsApp
    formFinalizar.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const telefonePizzaria = "5511999999999"; // Substitua pelo número real da pizzaria
      const mensagem = formatarPedidoParaWhatsApp();
      const urlWhatsApp = `https://wa.me/${telefonePizzaria}?text=${mensagem}`;
      
      window.open(urlWhatsApp, '_blank');
      fecharModalFinalizar();
      
      // Limpar carrinho após enviar
      carrinho = [];
      meiaPizzaPendente = null;
      renderCart();
      formFinalizar.reset();
    });

    // Inicialização
    renderCart();
  </script>
</body>
</html>
